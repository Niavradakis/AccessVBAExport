SELECT IssuedDocumentProductDetailsBackupT.*, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=False,0,IIf([Product_Values_YESisGross_NOisNet]=True,([Total_Value]-[Total_Vat_#]),[Total_Value])) AS Debit, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=True,0,IIf([Product_Values_YESisGross_NOisNet]=True,([Total_Value]-[Total_Vat_#]),[Total_Value])) AS Credit, IIf(IsNull([IssuedDocumentProductDetailsBackupT].[quantity]) Or IsNull([IssuedDocumentProductDetailsBackupT].[Unit_Price_Before_Discount]),0,IIf([Product_Values_YESisGross_NOisNet]=True,Round(Nz([IssuedDocumentProductDetailsBackupT].[quantity],0)*(Nz([IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount],0)-(Nz([IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount],0)/(1+[IssuedDocumentProductDetailsBackupT].[Vat%]))),2),Round(Nz([IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount],0)*[IssuedDocumentProductDetailsBackupT].[VAT%]*Nz([IssuedDocumentProductDetailsBackupT].[quantity],0),2))) AS [Total_Vat_#], IIf([Product_Values_YESisGross_NOisNet]=True,Round(([IssuedDocumentProductDetailsBackupT].[quantity]*[IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount]),2),Round(([IssuedDocumentProductDetailsBackupT].[quantity]*[IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount])+[Total_Vat_#],2)) AS Total_Gross_Value, Round([IssuedDocumentProductDetailsBackupT].[Quantity]*[IssuedDocumentProductDetailsBackupT].[Unit_Price_After_Discount],2) AS Total_Value, IssuableDocumentT.Product_Values_YESisGross_NOisNet, IssuableDocumentT.Is_Positive, IssuableDocumentT.[Main_Product_Entity_Debited(For_Product_Documents)], IssuedDocumentProductDetailsBackupT.IssuedDocumentProductDetailsID_Backup_ID AS IssuedDocProdDetailsID_Backup_ID, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=True,[IssuedDocumentProductDetailsBackupT].[Quantity],0) AS QuantityDebit, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=False,[IssuedDocumentProductDetailsBackupT].[Quantity],0) AS QuantityCredit, IIf([Debit]=0,0,[Total_Vat_#]) AS VatDebit, IIf([Credit]=0,0,[Total_Vat_#]) AS VatCredit
FROM (IssuableDocumentT INNER JOIN IssuedDocumentT ON IssuableDocumentT.Issuable_Document_ID = IssuedDocumentT.Issuable_Document_ID) INNER JOIN (IssuedDocumentProductDetailsBackupT INNER JOIN IssuedDocumentProductDetailsT ON IssuedDocumentProductDetailsBackupT.Issued_Document_Product_Details_ID = IssuedDocumentProductDetailsT.Issued_Document_Product_Details_ID) ON (IssuedDocumentT.Issued_Document_ID = IssuedDocumentProductDetailsT.Issued_Document_ID) AND (IssuedDocumentT.Issued_Document_ID = IssuedDocumentProductDetailsT.Issued_Document_ID);

