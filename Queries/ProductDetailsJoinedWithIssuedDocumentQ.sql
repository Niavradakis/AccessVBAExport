SELECT IssuedDocumentProductDetailsT.*, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=False,0,IIf([Product_Values_YESisGross_NOisNet]=True,([Total_Value]-[Total_Vat_#]),[Total_Value])) AS Debit, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=True,0,IIf([Product_Values_YESisGross_NOisNet]=True,([Total_Value]-[Total_Vat_#]),[Total_Value])) AS Credit, IIf(IsNull([quantity]) Or IsNull([Unit_Price_Before_Discount]),0,IIf([Product_Values_YESisGross_NOisNet]=True,Round(Nz([quantity],0)*(Nz([Unit_Price_After_Discount],0)-(Nz([Unit_Price_After_Discount],0)/(1+[IssuedDocumentProductDetailsT].[Vat%]))),2),Round(Nz([Unit_Price_After_Discount],0)*[IssuedDocumentProductDetailsT].[VAT%]*Nz([quantity],0),2))) AS [Total_Vat_#], IIf([Product_Values_YESisGross_NOisNet]=True,Round(([quantity]*[Unit_Price_After_Discount]),2),Round(([quantity]*[Unit_Price_After_Discount])+[Total_Vat_#],2)) AS Total_Gross_Value, Round([Quantity]*[Unit_Price_After_Discount],2) AS Total_Value, IssuableDocumentT.Product_Values_YESisGross_NOisNet, IssuableDocumentT.Is_Positive, IssuableDocumentT.[Main_Product_Entity_Debited(For_Product_Documents)], IssuedDocumentProductDetailsT.IssuedDocumentProductDetails_Backup_ID AS IssuedDocProdDetailsID_Backup_ID, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=True,[Quantity],0) AS QuantityDebit, IIf([Main_Product_Entity_Debited(For_Product_Documents)]=False,[Quantity],0) AS QuantityCredit, IIf([debit]=0,0,[Total_Vat_#]) AS VatDebit, IIf([Credit]=0,0,[Total_Vat_#]) AS VatCredit, IssuableDocumentT.Issuable_Document_Description, IssuedDocumentT.*, IntentionsT.Intention_Description, TransactorsWithBasicTransactorsDescriptionQ.Basic_Transactor_Description AS Financial_Transactor_Description, TransactorsWithBasicTransactorsDescriptionQ.Transactor_Type_Desription AS Financial_Transactor_Type_Desription, TransactorsWithBasicTransactorsDescriptionQ_1.Basic_Transactor_Description AS Vat_Transactor_Description, TransactorsWithBasicTransactorsDescriptionQ_1.Transactor_Type_Desription AS VAT_Transactor_Type_Desription, TransactorsWithBasicTransactorsDescriptionQ_2.Basic_Transactor_Description AS Product_Document_Other_Entity_Financial_Transactor_Description, TransactorsWithBasicTransactorsDescriptionQ_2.Transactor_Type_Desription AS Product_Document_Other_Entity_Financial_Transactor_Type_Description
FROM TransactorsWithBasicTransactorsDescriptionQ AS TransactorsWithBasicTransactorsDescriptionQ_2 INNER JOIN (((TransactionsT INNER JOIN (IssuableDocumentT INNER JOIN IssuedDocumentT ON IssuableDocumentT.Issuable_Document_ID = IssuedDocumentT.Issuable_Document_ID) ON TransactionsT.Transaction_ID = IssuedDocumentT.Transaction_ID) INNER JOIN IntentionsT ON IssuedDocumentT.Intention_ID = IntentionsT.Intention_ID) INNER JOIN (TransactorsWithBasicTransactorsDescriptionQ AS TransactorsWithBasicTransactorsDescriptionQ_1 INNER JOIN (TransactorsWithBasicTransactorsDescriptionQ INNER JOIN IssuedDocumentProductDetailsT ON TransactorsWithBasicTransactorsDescriptionQ.Transactor_ID = IssuedDocumentProductDetailsT.Financial_Transactor_ID) ON TransactorsWithBasicTransactorsDescriptionQ_1.Transactor_ID = IssuedDocumentProductDetailsT.Vat_Transactor_ID) ON (IssuedDocumentT.Issued_Document_ID = IssuedDocumentProductDetailsT.Issued_Document_ID) AND (IssuedDocumentT.Issued_Document_ID = IssuedDocumentProductDetailsT.Issued_Document_ID)) ON TransactorsWithBasicTransactorsDescriptionQ_2.Transactor_ID = IssuedDocumentT.[Transactor_Financial_ID(Other_Entity)]
WHERE (((TransactionsT.Is_Deleted)=False) AND ((IssuedDocumentT.IS_Deleted)=False) AND ((IssuedDocumentProductDetailsT.Is_Deleted)=False) AND ((IssuedDocumentT.Has_Been_Cancelled_By_Document_ID) Is Null));

